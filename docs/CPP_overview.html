<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HEBench: HEBench C++ Wrapper Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HEBench
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('CPP_overview.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">HEBench C++ Wrapper Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md144">High-level design and architecture overview</a></li>
<li class="level1"><a href="#autotoc_md145">Namespace</a></li>
<li class="level1"><a href="#autotoc_md146">Wrapper features</a><ul><li class="level2"><a href="#autotoc_md147">API Bridge Handle wrapping</a></li>
<li class="level2"><a href="#autotoc_md148">Error handling</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md149">Tutorial</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_docsrc_hebench_CPP_overview"></a></p>
<h1><a class="anchor" id="autotoc_md144"></a>
High-level design and architecture overview</h1>
<p>Backend engines are expected to be shared libraries (.so in Linux, .dll in Windows) that expose the <a class="el" href="APIBridge_overview.html">API Bridge</a> functionality. The functionality can be implemented by directly defining the required functions specified in the <a class="el" href="namespacehebench_1_1APIBridge.html">hebench::APIBridge</a> or extending the C++ wrapper <a class="el" href="namespacehebench_1_1cpp.html">hebench::cpp</a> .</p>
<p>The C++ wrapper offers a collection of pre-defined classes and functionality designed to ease the creation of backends by hiding boilerplate details required by the C API.</p>
<p>Backends created by extending the C++ wrapper require linking to a pre-compiled archive (.a in Linux, .lib in Windows). In contrast to the header-only API Bridge, the C++ wrapper archive can be generated by building the API Bridge project. This will also generate a simple example backend that uses the C++ wrapper.</p>
<p>For full information, check the full reference below, and for a practical use example, see the tutorial at the end of this page.</p>
<h1><a class="anchor" id="autotoc_md145"></a>
Namespace</h1>
<ul>
<li>Full reference to the C++ wrapper: <a class="el" href="namespacehebench_1_1cpp.html">hebench::cpp</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md146"></a>
Wrapper features</h1>
<p>The C++ wrapper offers a variety of helper classes and functionality to ease development of backends. Users must extend classes <code><a class="el" href="classhebench_1_1cpp_1_1BaseEngine.html" title="Base class that encapsulates common behavior of backend engines.">hebench::cpp::BaseEngine</a></code>, <code><a class="el" href="classhebench_1_1cpp_1_1BenchmarkDescription.html" title="Base class for objects representing a specific benchmark based on an HEBench benchmark descriptor.">hebench::cpp::BenchmarkDescription</a></code>, and <code><a class="el" href="classhebench_1_1cpp_1_1BaseBenchmark.html" title="Top level opaque benchmark class.">hebench::cpp::BaseBenchmark</a></code> to create a backend.</p>
<h2><a class="anchor" id="autotoc_md147"></a>
API Bridge Handle wrapping</h2>
<p>As communication between Test Harness and a backend through API Bridge occurs via opaque handles of type <code><a class="el" href="namespacehebench_1_1APIBridge.html#a1cc432e69cd60c216161fae560d8a6f4" title="Encapsulates an opaque handle to backend data.">hebench::APIBridge::Handle</a></code>, C++ wrapper offers a handy set of methods, part of <code><a class="el" href="classhebench_1_1cpp_1_1BaseEngine.html" title="Base class that encapsulates common behavior of backend engines.">hebench::cpp::BaseEngine</a></code> to assist on the creation of and extraction of information from opaque handles.</p>
<p>Templated method <code><a class="el" href="classhebench_1_1cpp_1_1BaseEngine.html#a1bee837f9a3b7ac50ff1b65ad0a415f5" title="Encapsulates an object of type T in an opaque HEBench handle.">hebench::cpp::BaseEngine::createHandle()</a></code> allows for the creation of an opaque handle that wraps around the constructed object. As part of its parameters, it takes the parameters to construct the object getting wrapped. It is convenient to use <code>CopyConstructible</code> or <code>CopyMovable</code> objects as it may be easier to construct an object and modify it before wrapping it in a handle. This method also allows for tagging and checks that the tag respects the C++ wrapper convention.</p>
<p>Users can call templated method <code><a class="el" href="classhebench_1_1cpp_1_1BaseEngine.html#a1951e5a864ad7699fd30a062b7e9576d" title="Retrieves the object of type T encapsulated in an opaque HEBench handle by method createHandle().">hebench::cpp::BaseEngine::retrieveFromHandle()</a></code> to retrieve a reference to an object wrapped in an opaque handle by <code>createHandle()</code> method. It also allows for tag checking to make sure that handle contains the correct information.</p>
<p>Method <code><a class="el" href="classhebench_1_1cpp_1_1BaseEngine.html#a8d8bc92e02f7ea4db5d013ce307adc3b" title="Duplicates a handle created by createhandle().">hebench::cpp::BaseEngine::duplicateHandle()</a></code> allows the shallow duplication of handles created by <code>createHandle()</code>, ensuring correct destruction order by keeping reference count of all the duplicated handles pointing to the same underlying object. This is a useful method when an API Bridge function needs to return its input handle(s) as results since most API Bridge functions require that returned handles are valid even after the input handles used to generate the result are destroyed. Note that as shallow copies, duplicated handles point to the same underlying object; therefore, modifying this object will affect all handles that point to it. Users must provide their own mechanisms to perform deep copies if and when required.</p>
<h3>C++ wrapper tagging</h3>
<p>Opaque handles expose a <code>tag</code> field of type <code>std::int64_t</code>. The tag field is designed for backends to identify their handles and be able to retrieve and process the information contained in the opaque handle correctly.</p>
<p>The values and usage of the <code>tag</code> are backend dependent and can be anything. However, backends that extend C++ wrapper must be aware that the 8 most significant bits of the <code>tag</code> are reserved for use by the C++ wrapper. Attempts to modify these bits may result in unexpected behavior. As a consequence, backends may use the remaining 56 least significant bits of the <code>tag</code> for their purposes. See <code><a class="el" href="classhebench_1_1cpp_1_1ITaggedObject.html" title="Represents an object with a tag.">hebench::cpp::ITaggedObject</a></code> for more information.</p>
<h2><a class="anchor" id="autotoc_md148"></a>
Error handling</h2>
<p>The preferred way to report an error inside a C++ wrapper-enabled backend is by throwing an exception of type <code><a class="el" href="classhebench_1_1cpp_1_1HEBenchError.html">hebench::cpp::HEBenchError</a></code>. This type of exception is interpreted by the wrapper and converted to the appropriate error, updating all related functionality expected by the API Bridge.</p>
<p>The error code for <code><a class="el" href="classhebench_1_1cpp_1_1HEBenchError.html">hebench::cpp::HEBenchError</a></code> must be an error code compatible with <code><a class="el" href="namespacehebench_1_1APIBridge.html#ac4f41509c36c615dbca2e2b16ff86641" title="Return value for API bridge functions.">hebench::APIBridge::ErrorCode</a></code>.</p>
<p>The message is whichever message users expect to be associated with this error. Macros <code>HEBERROR_MSG_CLASS</code> and <code>HEBERROR_MSG</code> offer shortcuts that will create messages containing the file name, function, line number, etc. where the error was thrown. Macro <code>HEBERROR_MSG_CLASS</code> can only be used inside a class where macro <code>HEBERROR_DECLARE_CLASS_NAME</code> has been added to the class definition. See examples and tutorial for more information on using these macros.</p>
<h1><a class="anchor" id="autotoc_md149"></a>
Tutorial</h1>
<ul>
<li><a class="el" href="simple_cpp_example.html">Quickstart C++ Wrapper Backend Tutorial</a> : A quick start example showing how to implement a simple backend by extending the C++ wrapper. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>

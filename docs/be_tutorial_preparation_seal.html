<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HEBench: Quickstart C++ Wrapper Backend Tutorial - Preparation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HEBench
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('be_tutorial_preparation_seal.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Quickstart C++ Wrapper Backend Tutorial - Preparation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md82">Steps</a><ul><li class="level2"><a href="#autotoc_md83">1. Copy example</a></li>
<li class="level2"><a href="#autotoc_md84">2. Rename files to new backend name</a></li>
<li class="level2"><a href="#autotoc_md85">3. Update build system</a></li>
<li class="level2"><a href="#autotoc_md86">4. Update includes in source files</a></li>
<li class="level2"><a href="#autotoc_md87">5. Define any new error codes</a></li>
<li class="level2"><a href="#autotoc_md88">6. Refactor classes</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md89">Tutorial steps</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_docsrc_examples_backend_tutorials_seal_backend_tutorial_preparation_seal"></a></p>
<h1><a class="anchor" id="autotoc_md82"></a>
Steps</h1>
<p>Before attempting these steps, you must have a built version of the API Bridge.</p>
<h2><a class="anchor" id="autotoc_md83"></a>
1. Copy example</h2>
<p>Start by copying api_bridge_example_be to a new folder with the name of the desired backend</p>
<p><code>api_bridge_example_backend</code> -&gt; <code>tutorial_backend</code></p>
<h2><a class="anchor" id="autotoc_md84"></a>
2. Rename files to new backend name</h2>
<p>After copying, the next step is to rename all of the included files to match the scheme of the new backend name. The files to rename are:</p>
<ul>
<li><code>src/ex_engine.cpp</code> -&gt; <code><a class="el" href="tutorial__engine__seal_8cpp.html">src/tutorial_engine_seal.cpp</a></code></li>
<li><code>src/ex_benchmark.cpp</code> -&gt; <code><a class="el" href="tutorial__eltwiseadd__benchmark__seal_8cpp.html">src/tutorial_eltwiseadd_benchmark_seal.cpp</a></code></li>
<li><code>include/ex_benchmark.h</code> -&gt; <code><a class="el" href="tutorial__eltwiseadd__benchmark__seal_8h.html">include/tutorial_eltwiseadd_benchmark_seal.h</a></code></li>
<li><code>include/ex_engine.h</code> -&gt; <code><a class="el" href="tutorial__engine__seal_8h.html">include/tutorial_engine_seal.h</a></code></li>
<li>new file -&gt; <code><a class="el" href="tutorial__error__seal_8h.html">include/tutorial_error_seal.h</a></code></li>
</ul>
<h2><a class="anchor" id="autotoc_md85"></a>
3. Update build system</h2>
<p>Update the <code>CMakeLists.txt</code> to become stand-alone: point to the new file names, change the target name as appropriate, locate include directory for and link hebench_cpp static library, locate and link other third-party dependencies, like Microsoft SEAL for this tutorial.</p>
<p>For simplicity, this build system will assume that all dependencies have been pre-compiled (Microsoft SEAL is assumed to be installed). Creating a robust build system is beyond the scope of this tutorial.</p>
<p>Find the listing of the full <code>CMakeLists.txt</code> stand-alone below. Make sure to replace <code>"/include/directory/for/api_bridge"</code> and <code>"/directory/containing/libhebench_cpp.a"</code> for the correct paths.</p>
<pre class="fragment"># Copyright (C) 2021 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

cmake_minimum_required(VERSION 3.12)
project(be_tutorial LANGUAGES C CXX)

# C++ version (SEAL requires 17)
set(CMAKE_CXX_STANDARD 17) # C++ standard C++17
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

set(${PROJECT_NAME}_SOURCES
    "${CMAKE_CURRENT_SOURCE_DIR}/src/tutorial_engine_seal.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/src/tutorial_eltwiseadd_benchmark_seal.cpp"
    )
set(${PROJECT_NAME}_HEADERS
    "${CMAKE_CURRENT_SOURCE_DIR}/include/tutorial_error_seal.h"
    "${CMAKE_CURRENT_SOURCE_DIR}/include/tutorial_engine_seal.h"
    "${CMAKE_CURRENT_SOURCE_DIR}/include/tutorial_eltwiseadd_benchmark_seal.h"
    )

add_library(${PROJECT_NAME} SHARED ${${PROJECT_NAME}_SOURCES} ${${PROJECT_NAME}_HEADERS})
target_include_directories(${PROJECT_NAME} PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/include)

# All external libraries are assumed to be pre-compiled for tutorial simplicity.

# find the hebench_cpp archive
set(HEBENCH_API_INCLUDE_DIR "/include/directory/for/api_bridge")
target_include_directories(${PROJECT_NAME} PRIVATE ${HEBENCH_API_INCLUDE_DIR}) # point to include for api_bridge
find_library(hebench_cpp_FOUND NAMES libhebench_cpp.a HINTS "/directory/containing/libhebench_cpp.a")
if(hebench_cpp_FOUND)
    add_library(hebench_cpp UNKNOWN IMPORTED)
    # populate the found library with its properties
    set_property(TARGET hebench_cpp PROPERTY IMPORTED_LOCATION ${hebench_cpp_FOUND})
    set_property(TARGET hebench_cpp APPEND PROPERTY INTERFACE_INCLUDE_DIRECTORIES ${HEBENCH_API_INCLUDE_DIR})
    message(STATUS "libhebench_cpp.a found")
else()
    message(FATAL_ERROR "libhebench_cpp.a not found.")
endif()

# link found library
target_link_libraries(${PROJECT_NAME} PUBLIC "-Wl,--whole-archive" hebench_cpp "-Wl,--no-whole-archive")

# find other third party dependencies
# pre-built Microsoft SEAL 3.6
set(SEAL_INCLUDE_DIR "/usr/local/include/SEAL-3.6")
target_include_directories(${PROJECT_NAME} PRIVATE ${SEAL_INCLUDE_DIR}) # point to include for SEAL
find_library(SEAL_FOUND NAMES libseal-3.6.a HINTS "/usr/local/lib")
if(SEAL_FOUND)
    add_library(seal-3.6 UNKNOWN IMPORTED)
    # populate the found library with its properties
    set_property(TARGET seal-3.6 PROPERTY IMPORTED_LOCATION ${SEAL_FOUND})
    set_property(TARGET seal-3.6 APPEND PROPERTY INTERFACE_INCLUDE_DIRECTORIES ${SEAL_INCLUDE_DIR})
else()
    message(FATAL_ERROR "libseal-3.6.a not found.")
endif()

# link found library
target_link_libraries(${PROJECT_NAME} PUBLIC "-Wl,--whole-archive" seal-3.6 "-Wl,--no-whole-archive")

# extra compile options
target_compile_options(${PROJECT_NAME} PRIVATE -Wall -Wextra) # show warnings

# install options
include(GNUInstallDirs)
set(CMAKE_INSTALL_RPATH "${CMAKE_INSTALL_PREFIX}/lib")
install(TARGETS ${PROJECT_NAME} DESTINATION lib)
</pre><h2><a class="anchor" id="autotoc_md86"></a>
4. Update includes in source files</h2>
<p>After renaming our files for our new engine we must update the includes in the example files as follows.</p>
<p><b><a class="el" href="tutorial__engine__seal_8cpp.html">tutorial_engine_seal.cpp</a></b></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;../include/ex_engine_seal.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// include all benchmarks</span></div>
<div class="line"><span class="preprocessor">#include &quot;../include/ex_benchmark_seal.h&quot;</span></div>
</div><!-- fragment --><p> changed to</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tutorial__engine__seal_8h.html">tutorial_engine_seal.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tutorial__error__seal_8h.html">tutorial_error_seal.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// include all benchmarks</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tutorial__eltwiseadd__benchmark__seal_8h.html">tutorial_eltwiseadd_benchmark_seal.h</a>&quot;</span></div>
<div class="ttc" id="atutorial__eltwiseadd__benchmark__seal_8h_html"><div class="ttname"><a href="tutorial__eltwiseadd__benchmark__seal_8h.html">tutorial_eltwiseadd_benchmark_seal.h</a></div></div>
<div class="ttc" id="atutorial__engine__seal_8h_html"><div class="ttname"><a href="tutorial__engine__seal_8h.html">tutorial_engine_seal.h</a></div></div>
<div class="ttc" id="atutorial__error__seal_8h_html"><div class="ttname"><a href="tutorial__error__seal_8h.html">tutorial_error_seal.h</a></div></div>
</div><!-- fragment --><p><b><a class="el" href="tutorial__eltwiseadd__benchmark__seal_8cpp.html">tutorial_eltwiseadd_benchmark_seal.cpp</a></b></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;../include/ex_benchmark_seal.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../include/ex_engine_seal.h&quot;</span></div>
</div><!-- fragment --><p>changed to</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tutorial__eltwiseadd__benchmark__seal_8h.html">tutorial_eltwiseadd_benchmark_seal.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tutorial__engine__seal_8h.html">tutorial_engine_seal.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tutorial__error__seal_8h.html">tutorial_error_seal.h</a>&quot;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md87"></a>
5. Define any new error codes</h2>
<p>Add the following content to <code><a class="el" href="tutorial__error__seal_8h.html">tutorial_error_seal.h</a></code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#define TUTORIAL_ECODE_SEAL_ERROR 2</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md88"></a>
6. Refactor classes</h2>
<p>Now that we have renamed the files to a name suitable for our new backend we must rename the example classes described in the files to the names of our new backend. For this step it is highly recommend to use an IDE with support for automatic class refactoring.</p>
<p>Refactor the following classes to the new name:</p>
<p><b><a class="el" href="tutorial__engine__seal_8h.html">tutorial_engine_seal.h</a></b></p>
<ul>
<li><code>ExampleEngine</code> -&gt; <code>TutorialEngine</code></li>
</ul>
<p><b><a class="el" href="tutorial__eltwiseadd__benchmark__seal_8h.html">tutorial_eltwiseadd_benchmark_seal.h</a></b></p>
<ul>
<li><code>ExampleBenchmark</code> -&gt; <code>TutorialEltwiseAddBenchmark</code></li>
<li><code>ExampleBenchmarkDescription</code> -&gt; <code>TutorialEltwiseAddBenchmarkDescription</code></li>
</ul>
<hr  />
 <h3>Checkpoint</h3>
<p>After completing this step it may be a good idea to try compiling the backend and running it. In its current state, if the above steps have been followed, the backend should run and perform a simple matrix multiplication in plain text. The next steps will discuss the steps to perform our benchmark instead. </p><hr  />
<h1><a class="anchor" id="autotoc_md89"></a>
Tutorial steps</h1>
<p><a class="el" href="simple_cpp_example_seal.html#md_docsrc_examples_backend_tutorials_seal_backend_tutorial_seal">Tutorial Home</a><br  />
 <b>Preparation</b><br  />
 <a class="el" href="be_tutorial_init_seal.html#md_docsrc_examples_backend_tutorials_seal_backend_tutorial_init_seal">Engine Initialization and Benchmark Description</a><br  />
 <a class="el" href="be_tutorial_impl_seal.html#md_docsrc_examples_backend_tutorials_seal_backend_tutorial_impl_seal">Benchmark Implementation</a><br  />
 <a class="el" href="be_tutorial_files_seal.html#md_docsrc_examples_backend_tutorials_seal_backend_tutorial_files_seal">File References</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>

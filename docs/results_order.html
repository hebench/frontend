<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HEBench: Ordering of Results Based on Input Batch Sizes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HEBench
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('results_order.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ordering of Results Based on Input Batch Sizes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md13">Order of Input Samples in a Batch</a></li>
<li class="level1"><a href="#autotoc_md14">Order of Results Based on Input Batch Ordering</a></li>
<li class="level1"><a href="#autotoc_md15">Parameter Indexers in API Bridge operate()</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_docsrc_categories_results_ordering"></a></p>
<p>The following defines the ordering of results based on batched input.</p>
<p>It is recommended to refer to <a class="el" href="glossary.html">Glossary</a> for a list of terms used in this document.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Order of Input Samples in a Batch</h1>
<p>Some workload categories in HEBench, such as <b>offline</b>, allow processing on a batch of input samples so that backends can optimize execution for an input batch, instead of operating on a single input sample at a time.</p>
<p>Given component batches for the input, Test Harness combines a component sample for each input component to form an input sample. The order of the input samples in a batch given the input component samples follows <b>row-major ordering</b>. This means that the index for the most significant operation parameter moves faster when computing the index of an input sample in the ordering, given the indices of all of the component samples that make up said input sample.</p>
<p>In general, let <code>n</code> be the number of components in the input vector <code>(input_0, input_1, ..., input_n-1)</code>. If component samples in component batch <code>i</code> are ordered from <code>0</code> to <code>cn[i] - 1</code>, where <code>cn[i]</code> is the size for component batch <code>i</code>, and <code>param[i]</code> is the index of the component sample to use for operand <code>input_i</code> , then, the index <code>r</code> for an input sample is computed using the algorithm below.</p>
<div class="fragment"><div class="line">r = param[0];</div>
<div class="line"><span class="keywordflow">for</span> (i = 1; i &lt; n; ++i)</div>
<div class="line">    r = param[i] + cn[i] * r;</div>
</div><!-- fragment --><p>The input batch size is: </p><div class="fragment"><div class="line">bacth_size = 0;</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; n; ++i)</div>
<div class="line">    bacth_size *= cn[i];</div>
</div><!-- fragment --><p> <br  />
 </p><hr  />
<p> <b>Example</b></p>
<p>Assume a workload for the ternary operation defined as follows: </p><div class="fragment"><div class="line">(result_0, result_1) = op3(input_0, input_1, input_2)</div>
</div><!-- fragment --><p>Assume that Test Harness will request operation on an input batch, and the input samples are specified using a component batch for each operation parameter.</p>
<p>Let <code>cn[i]</code> be the batch size for component <code>input_i</code>, and:</p>
<div class="fragment"><div class="line">cn[0] = 2</div>
<div class="line">cn[1] = 1</div>
<div class="line">cn[2] = 3</div>
</div><!-- fragment --><p>which means that there are <code>2</code> samples for <code>input_0</code>, <code>1</code> sample for <code>input_1</code>, and <code>3</code> samples for <code>input_2</code>.</p>
<p>Given this example's configuration and based on the algorithm for computation of the index order <code>r</code> for an input sample listed earlier, the following table shows the order in which Test Harness expects a backend to form the input samples based on the component batches:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>r</code>   </th><th class="markdownTableHeadNone"><code>param[0]</code>   </th><th class="markdownTableHeadNone"><code>param[1]</code>   </th><th class="markdownTableHeadNone"><code>param[2]</code>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">2   </td></tr>
</table>
<p>or, unrolling the loop for the computation of <code>r</code>:</p>
<div class="fragment"><div class="line">r = param[2] + cn[2] * param[1] + cn[2] * cn[1] * param[0]</div>
</div><!-- fragment --> <hr  />
 <h1><a class="anchor" id="autotoc_md14"></a>
Order of Results Based on Input Batch Ordering</h1>
<p>Because the definition of operation requires a mapping from an input sample to a result vector, there is a result for every input sample in an input batch.</p>
<p>When Test Harness passes an input batch of size <code>n</code> to a backend for processing, it is expected that the backend will form the input samples using the order defined in the previous section. Test Harness expects <code>n</code> results in return, and, because of the operation definition, the result vector at index <code>r</code> must be the output of the operation on the <code>r</code>-th input sample. </p><hr  />
<p><b>Example</b></p>
<p>Following the previous example, given such configuration, Test Harness expects <code>6</code> results because the input batch size is <code>6</code>.</p>
<p>If we have the following components to form an input sample:</p>
<div class="fragment"><div class="line">param[0] = 1</div>
<div class="line">param[1] = 0</div>
<div class="line">param[2] = 1</div>
</div><!-- fragment --><p>then, the sample index for the input and corresponding result is:</p>
<div class="fragment"><div class="line">r = param[2] + cn[2] * param[1] + cn[2] * cn[1] * param[0]</div>
<div class="line">  = 1 + 3 * 0 + 3 * 1 * 1</div>
<div class="line">  = 4</div>
</div><!-- fragment --> <hr  />
<h1><a class="anchor" id="autotoc_md15"></a>
Parameter Indexers in API Bridge operate()</h1>
<p>A parameter to <code><a class="el" href="namespacehebench_1_1APIBridge.html#a3d07f6b56035cea3fad6fd7005b22de0" title="Performs the workload operation of the benchmark.">hebench::APIBridge::operate()</a></code> is <code>const <a class="el" href="namespacehebench_1_1APIBridge.html#structhebench_1_1APIBridge_1_1ParameterIndexer" title="Indexes a DataPack.">hebench::APIBridge::ParameterIndexer</a> *p_param_indexers</code>. This is an array of parameter indexers with as many elements as parameters for the workload operation. A parameter indexer structure is defined as:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ParameterIndexer</div>
<div class="line">{</div>
<div class="line">    std::uint64_t value_index;</div>
<div class="line">    std::uint64_t batch_size;</div>
<div class="line">};</div>
</div><!-- fragment --><p> where <code>value_index</code> is the index for the component sample inside the loaded input component dataset where this parameter's component batch starts. Field <code>batch_size</code> specifies the number of elements in the component batch, starting from the specified index.</p>
<p>This structure is provided for workload flexibility, but Test Harness default behavior is to load a complete batch per component and set the corresponding <code>ParameterIndexer::value_index</code> to <code>0</code> and <code>ParameterIndexer::batch_size</code> to the loaded number of elements for the component batch.</p>
<p>When a workload or category specifies non-default behavior in this regard, the index of the first input sample is computed using the <code>value_index</code> for all <code>ParameterIndexer</code>s in this array. However, after decoding, the results of the workload operation must always be stored starting at index <code>0</code> regardless; where result at <code>0</code> is the result of operating on first input sample; result at <code>1</code> corresponds to second input sample, and so on. Test Harness will take into account the starting input offset when validating against ground truth values, thus backends must not offset the results. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
